<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="CG works collection.">
    <title>PIESEVEN's WORKS</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
</head>

<body id="index">

    <div class="wrapper">
        <div class="header">
            <div class="logo">
                PEISEVEN'<span>S</span> WORKS
            </div><!-- LOGO -->
            <div class="nav">
                <div class="menu">
                    <div class="menu-item"><a href="/zh">ZH</a></div>|
                    <div class="menu-item"><span>EN</span></div>
                </div>
            </div>
        </div>

        <div id="top" class="swiper top">
            <div class="top-left">
                <div class="card-box">
                    <div class="card box-border">
                        <div class="card-overlay">
                            a1
                        </div>
                    </div>
                    <div class="card box-border">

                        <div class="card-overlay">
                            a2
                        </div>
                    </div>
                    <div class="card box-border">

                        <div class="card-overlay">
                            a3
                        </div>
                    </div>
                </div>
                <div class="copy">
                    Copyright &copy; 2022 PIESEVEN All rights.
                </div>
            </div>

            <div class="top-center">
                <div class="top-center-1" style="margin: 0 auto;">
                    <a href="#footer">
                        <div id="wrapper"></div>
                    </a>
                </div>
            </div>

            <div class="top-right">
                <div class="cot-box">
                    <div class="cot"><a href="#top">HOME</a></div>
                    <div class="cot"><a href="#works">WORKS</a></div>
                    <div class="cot"><a href="#contact">CONTACT</a></div>
                </div>
                <div class="license">
                    <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
                        Creative Commons BY-NC-SA 4.0 International License</a>.
                </div>
            </div>
        </div>
        <div id="works" class="swiper works">
            <div class="works-box">
                <div class="works-card box-border">

                    <div class="card-overlay">
                        b1
                    </div>
                </div>
                <div class="works-card box-border">

                    <div class="card-overlay">
                        b2
                    </div>
                </div>
                <div class="works-card box-border">

                    <div class="card-overlay">
                        b3
                    </div>
                </div>
                <div class="works-card box-border">

                    <div class="card-overlay">
                        b4
                    </div>
                </div>
                <div class="works-card box-border">

                    <div class="card-overlay">
                        b5
                    </div>
                </div>
                <div class="works-card box-border">

                    <div class="card-overlay">
                        b6
                    </div>
                </div>
            </div>
        </div>
        <div id="contact" class="swiper contact">
            <div class="contact-box box-border">
                <div class="card-overlay">
                    <div class="social-link"></div>
                    <div class="email"></div>
                </div>
            </div>
        </div>
        <div class="linear"></div>
        <div class="linear1"></div>
        <div class="bg">
            <div class="bg-overlay"></div>
            <video autoplay="autoplay" loop="loop" muted width="100%" src="imgs/bg.mp4"></video>
        </div>
    </div>
    <script>

    </script>
    <script>
        class Loop {
            constructor() {
                this._idRAF = -1;
                this._count = 0;
                this._listeners = [];
                this._binds = {};
                this._binds.update = this._update.bind(this);
            }
            _update() {
                let listener = null;
                let i = this._count;
                while (--i >= 0) {
                    listener = this._listeners[i];
                    if (listener) {
                        listener.apply(this, null);
                    }
                }
                this._idRAF = requestAnimationFrame(this._binds.update);
            }
            start() {
                this._update();
            }
            stop() {
                cancelAnimationFrame(this._idRAF);
            }
            add(listener) {
                const idx = this._listeners.indexOf(listener);
                if (idx >= 0) {
                    return;
                }
                this._listeners.push(listener);
                this._count++;
            }
            remove(listener) {
                const idx = this._listeners.indexOf(listener);
                if (idx < 0) {
                    return;
                }
                this._listeners.splice(idx, 1);
                this._count--;
            }
        }
        const loop = new Loop();
        loop.start();

        /**
         * Word Shuffler
         * Get a word into a div element and animate him to shuffling wheres letters
         * @type {[type]}
         */
        class LetterShuffler {
            constructor(wrapper, letter, { duration = 30 } = {}) {
                this.SHUFFLING_VALUES = [
                    "!",
                    "§",
                    "$",
                    "%",
                    "&",
                    "/",
                    "(",
                    ")",
                    "=",
                    "?",
                    "_",
                    "<",
                    ">",
                    "^",
                    "°",
                    "*",
                    "#",
                    "-",
                    ":",
                    ";",
                    "~"
                ];
                this.id = Math.random();
                this.animate = false;

                this.wrapper = wrapper;
                this.letter = letter;
                this.letterToShown = this.letter;
                this.wrapper.innerHTML = "";
                this.timer = 0;
                this.duration = 30;
                this.scaleTargeted = 2;

                this.show = this.show.bind(this);
                this.update = this.update.bind(this);

                // Regex Thank to @milesmanners !
                // https://codepen.io/milesmanners/
                if (/[+\-| ]/.test(letter)) {
                    this.wrapper.classList.add("purple");
                } else {
                    this.duration *= 2.1;
                }
            }

            show(letter = this.letter) {
                this.animate = true;
                this.timer = 0;
                this.letterToShown = letter;
                loop.add(this.update);
            }

            hide() {
                this.show("");
            }

            update() {
                if (this.animate) {
                    this.timer++;
                    if (this.timer < this.duration) {
                        this.wrapper.innerHTML = this.SHUFFLING_VALUES[
                            Math.floor(Math.random() * this.SHUFFLING_VALUES.length)
                        ];
                        this.wrapper.style.transform = `scale(${(this.timer / this.duration) * 0.9
                            })`;
                    } else {
                        this.wrapper.innerHTML = this.letterToShown;
                        loop.remove(this.update);
                    }
                }
            }
        }

        /**
         *
         */
        class WordShuffler {
            constructor(wrapper, words, { duration = 0.2 } = {}) {
                this.wrapper = wrapper;
                this.wrapper.innerHTML = "";

                this.timer = 0;
                this.lettersShown = 0;
                this.letterDuration = duration * 60;
                this.lettersShuffler = [];
                this.arrayOfLetters = [...words];
                this.duration = this.letterDuration * this.arrayOfLetters.length;

                this.arrayOfLetters.forEach((letter) => {
                    const letterWrapper = document.createElement("span");
                    this.wrapper.appendChild(letterWrapper);
                    const letterShuffler = new LetterShuffler(letterWrapper, letter, {
                        duration: this.letterDuration
                    });
                    this.lettersShuffler.push(letterShuffler);
                });

                this.update = this.update.bind(this);
                this.timer = 0;
            }

            show() {
                this.timer = 0;
                this.lettersShown = 0;
                loop.add(this.update);
            }

            update() {
                this.timer += 1;
                if (this.timer > this.letterDuration * this.lettersShown) {
                    this.lettersShuffler[this.lettersShown].show();
                    this.lettersShown += 1;
                }

                if (this.timer >= this.duration) {
                    loop.remove(this.update);
                }
            }
        }

        const WORDS = [
            "+  -                             -  +",
            "                                     ",
            "|          Welcome, friend.         |",
            "                                     ",
            "+  -                             -  +"
        ];

        class TextShuffler {
            constructor(wrapper, lines) {
                this.i = 0;
                this.lines = [];
                this.durationInterval = 50;
                this.wrapper = wrapper;
                for (let i = 0; i < lines.length; i++) {
                    this.lines.push(this._addLine(lines[i]));
                }
            }

            _addLine(line) {
                const lineElm = document.createElement("p");
                this.wrapper.appendChild(lineElm);
                const word = new WordShuffler(lineElm, line, { duration: 0.05 });
                return word;
            }

            show() {
                this.i = 0;
                const interval = setInterval(() => {
                    this.lines[this.i].show();
                    this.i += 1;

                    if (this.i === this.lines.length) {
                        clearInterval(interval);
                    }
                }, this.durationInterval);
            }

            hide() { }
        }

        // START
        const wrapper = document.getElementById("wrapper");
        const text = new TextShuffler(wrapper, WORDS);
        text.show();

        let show = true;
        setInterval(() => {
            text.show();
            show = !show;
        }, 4000);
    </script>
</body>

</html>